<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netlify éƒ¨ç½²è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 12px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #e8f5e8; border-color: #4caf50; }
        .warning { background: #fff3e0; border-color: #ff9800; }
        .error { background: #ffebee; border-color: #f44336; }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1976d2; }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .test-result.success { background: #e8f5e8; border-color: #4caf50; }
        .test-result.error { background: #ffebee; border-color: #f44336; }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Netlify éƒ¨ç½²è°ƒè¯•é¡µé¢</h1>
        
        <div class="info-box success">
            <h3>âœ… å¦‚æœä½ èƒ½çœ‹åˆ°è¿™ä¸ªé¡µé¢ï¼Œè¯´æ˜åŸºæœ¬éƒ¨ç½²æ˜¯æˆåŠŸçš„ï¼</h3>
            <p>è¿™ä¸ªé¡µé¢å°†å¸®åŠ©ä½ è¯Šæ–­ 404 é—®é¢˜çš„å…·ä½“åŸå› ã€‚</p>
        </div>

        <div class="info-box">
            <h3>ğŸ“Š åŸºæœ¬ä¿¡æ¯</h3>
            <p><strong>å½“å‰URL:</strong> <span id="current-url"></span></p>
            <p><strong>åŸŸå:</strong> <span id="hostname"></span></p>
            <p><strong>æ˜¯å¦ä¸ºNetlifyç¯å¢ƒ:</strong> <span id="is-netlify"></span></p>
            <p><strong>ç”¨æˆ·ä»£ç†:</strong> <span id="user-agent"></span></p>
        </div>

        <h3>ğŸ§ª æ–‡ä»¶æµ‹è¯•</h3>
        <button onclick="testFile('/')">æµ‹è¯•é¦–é¡µ (/)</button>
        <button onclick="testFile('/index.html')">æµ‹è¯• index.html</button>
        <button onclick="testFile('/news/news.html')">æµ‹è¯•æ–°é—»é¡µé¢</button>
        <button onclick="testFile('/news/news.json')">æµ‹è¯• news.json</button>
        <button onclick="testFile('/api/news')">æµ‹è¯• API ç«¯ç‚¹</button>
        <button onclick="testAllFiles()">ğŸ” æµ‹è¯•æ‰€æœ‰å…³é”®æ–‡ä»¶</button>

        <div id="test-results"></div>

        <div class="info-box warning">
            <h3>ğŸ’¡ å¸¸è§ 404 åŸå› </h3>
            <ul>
                <li><strong>é‡å®šå‘è§„åˆ™å†²çª:</strong> _redirects å’Œ netlify.toml ä¸­çš„è§„åˆ™å¯èƒ½å†²çª</li>
                <li><strong>æ–‡ä»¶è·¯å¾„é”™è¯¯:</strong> æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åœ¨æ­£ç¡®ä½ç½®</li>
                <li><strong>æ„å»ºé…ç½®é—®é¢˜:</strong> publish ç›®å½•è®¾ç½®ä¸æ­£ç¡®</li>
                <li><strong>ç¼“å­˜é—®é¢˜:</strong> Netlify CDN ç¼“å­˜äº†æ—§çš„é…ç½®</li>
            </ul>
        </div>

        <div class="info-box">
            <h3>ğŸ“‹ è§£å†³æ­¥éª¤</h3>
            <ol>
                <li>è¿è¡Œä¸Šé¢çš„æ–‡ä»¶æµ‹è¯•ï¼ŒæŸ¥çœ‹å“ªäº›æ–‡ä»¶æ— æ³•è®¿é—®</li>
                <li>æ£€æŸ¥ Netlify æ§åˆ¶å°çš„éƒ¨ç½²æ—¥å¿—</li>
                <li>åœ¨ Netlify ä¸­æ¸…é™¤ç¼“å­˜å¹¶é‡æ–°éƒ¨ç½²</li>
                <li>éªŒè¯ _redirects æ–‡ä»¶é…ç½®</li>
            </ol>
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('current-url').textContent = window.location.href;
            document.getElementById('hostname').textContent = window.location.hostname;
            document.getElementById('user-agent').textContent = navigator.userAgent;
            
            // æ£€æµ‹æ˜¯å¦ä¸º Netlify ç¯å¢ƒ
            const hostname = window.location.hostname;
            const isNetlify = hostname.includes('netlify.app') || 
                             hostname.includes('netlify.com') ||
                             hostname.includes('craft.luminolsuki.moe');
            document.getElementById('is-netlify').textContent = isNetlify ? 'æ˜¯ âœ…' : 'å¦ âŒ';
            
            console.log('ğŸ”§ è°ƒè¯•é¡µé¢åŠ è½½å®Œæˆ');
            console.log('ğŸ“ å½“å‰ç¯å¢ƒ:', {
                url: window.location.href,
                hostname: hostname,
                isNetlify: isNetlify,
                pathname: window.location.pathname
            });
        });

        async function testFile(path) {
            const resultsDiv = document.getElementById('test-results');
            const testResult = document.createElement('div');
            testResult.className = 'test-result';
            
            try {
                console.log(`ğŸ§ª æµ‹è¯•æ–‡ä»¶: ${path}`);
                const startTime = Date.now();
                const response = await fetch(path, { 
                    cache: 'no-cache',
                    method: 'HEAD' // ä½¿ç”¨ HEAD è¯·æ±‚èŠ‚çœå¸¦å®½
                });
                const endTime = Date.now();
                
                const result = {
                    path: path,
                    status: response.status,
                    statusText: response.statusText,
                    ok: response.ok,
                    url: response.url,
                    redirected: response.redirected,
                    responseTime: endTime - startTime,
                    contentType: response.headers.get('content-type')
                };
                
                console.log('ğŸ“Š æµ‹è¯•ç»“æœ:', result);
                
                if (response.ok) {
                    testResult.className += ' success';
                    testResult.innerHTML = `
                        <h4>âœ… ${path} - æˆåŠŸ</h4>
                        <p><strong>çŠ¶æ€:</strong> ${response.status} ${response.statusText}</p>
                        <p><strong>å®é™…URL:</strong> ${response.url}</p>
                        <p><strong>å“åº”æ—¶é—´:</strong> ${endTime - startTime}ms</p>
                        <p><strong>å†…å®¹ç±»å‹:</strong> ${response.headers.get('content-type') || 'æœªçŸ¥'}</p>
                        ${response.redirected ? '<p><strong>âš ï¸ å‘ç”Ÿäº†é‡å®šå‘</strong></p>' : ''}
                    `;
                } else {
                    testResult.className += ' error';
                    testResult.innerHTML = `
                        <h4>âŒ ${path} - å¤±è´¥</h4>
                        <p><strong>çŠ¶æ€:</strong> ${response.status} ${response.statusText}</p>
                        <p><strong>å®é™…URL:</strong> ${response.url}</p>
                        <p><strong>å¯èƒ½åŸå› :</strong> æ–‡ä»¶ä¸å­˜åœ¨æˆ–é‡å®šå‘é…ç½®é”™è¯¯</p>
                    `;
                }
            } catch (error) {
                console.error(`âŒ æµ‹è¯• ${path} å¤±è´¥:`, error);
                testResult.className += ' error';
                testResult.innerHTML = `
                    <h4>âŒ ${path} - ç½‘ç»œé”™è¯¯</h4>
                    <p><strong>é”™è¯¯:</strong> ${error.message}</p>
                    <p><strong>å¯èƒ½åŸå› :</strong> ç½‘ç»œé—®é¢˜æˆ–CORSé™åˆ¶</p>
                `;
            }
            
            resultsDiv.appendChild(testResult);
        }

        async function testAllFiles() {
            const files = ['/', '/index.html', '/news/news.html', '/news/news.json', '/api/news'];
            document.getElementById('test-results').innerHTML = '<h3>ğŸ” æ­£åœ¨æµ‹è¯•æ‰€æœ‰å…³é”®æ–‡ä»¶...</h3>';
            
            for (const file of files) {
                await testFile(file);
                // æ·»åŠ å°å»¶è¿Ÿé¿å…è¿‡å¿«è¯·æ±‚
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            console.log('âœ… æ‰€æœ‰æ–‡ä»¶æµ‹è¯•å®Œæˆ');
        }
    </script>
</body>
</html>
